---
title: "getting-started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{getting-started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# gimap tutorial

TODO: Describe what this genetic interaction analysis actually is and why someone would want to do it. 

```{r}
library(magrittr)
library(gimap)
```

## Data requirements 

TODO: What kind of data would someone need to run this? How much flexibility is there in what the experimental set up might look like? 

Let's examine this example pgPEN counts table. It's divided into columns containing: 

- an ID corresponding to the names of paired guides
- gRNA sequence 1, targeting "paralog A"
- gRNA sequence 2, targeting "paralog B"
- The sample, day, and replicate number for which gRNAs were sequenced

```{r}
example_data <- gimap::example_data()
The metadata you have may vary slightly from this but you'll want to make sure you have the essential variables and information regarding how you collected your data. 
example_data
```

```{r}
colnames(example_data)
```

## Setting up data

We're going to set up three datasets. The first is required, it's the counts that the genetic interaction analysis will be used for. 

The first data set contains the readcounts from each sample type. Required for analysis is a Day 0 (or plasmid) sample, and at least one further timepoint sample. QC analysis will follow to correlate replicates if inputted. Comparison of early and late timepoints is possible in this function, but not required if early timepoints were not taken. 

```{r}
example_counts <- example_data %>%
  dplyr::select(c("Day00_RepA", "Day05_RepA", "Day22_RepA", "Day22_RepB", "Day22_RepC")) %>%
  as.matrix()
```

The next two datasets are metadata that describe the dimensions of the count data. 
- These both need to be data frames. 
- The sizes of these metadata must correspond to the dimensions of the counts data. 
- The first column of the pg_metadata must be a unique id

`pg_metadata` is the information that describes the paired guide RNA targets. This information contains a table of the paired guide RNA sequences and the corresponding paralog gene that is being targeted for cutting by the gRNA-Cas9 complex.

```{r}

example_pg_metadata <- example_data %>%
  dplyr::select(c("id", "seq_1", "seq_2"))
```

`sample_metadata` is the information that describes timepoint information and replicate information relating to each sample. In general, two replicates at each timepoint are carried through to analysis, where they are later collapsed. 

```{r}
example_sample_metadata <- data.frame(
  id = 1:5,
  day = as.factor(c("Day00", "Day05", "Day22", "Day22", "Day22")), 
  rep = as.factor(c("RepA", "RepA", "RepA", "RepB", "RepC"))
)
```

Now let's setup our data using `setup_data()`. Optionally we can provide the metadata in this function as well so that it is stored with the data. 

```{r}
gimap_dataset <-  gimap::setup_data(counts = example_counts, 
                            pg_metadata = example_pg_metadata,
                            sample_metadata = example_sample_metadata)
```

You'll notice that this set up gives us a list of formatted data. This contains the original counts we gave `setup_data()` function but also normalized counts, and the total counts per sample. 

```{r}
str(gimap_dataset)
```

```{r}
sessionInfo()
```
