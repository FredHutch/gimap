<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Normalize Log fold changes — gimap_normalize • gimap</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Normalize Log fold changes — gimap_normalize"><meta property="og:description" content="This calculates the log fold change for a gimap dataset based on
the annotation and metadata provided.
gimap takes in a counts matrix that represents the number of cells that have
each type of pgRNA this data needs some normalization before CRISPR scores and
Genetic Interaction scores can be calculated.
There are four steps of normalization.
1. `Calculate log2CPM` - First we account for different read depths across samples
and transforms data to log2 counts per million reads.
`log2((counts / total counts for sample)) * 1 million) + 1)`
2. `Calculate log2 fold change` - This is done by subtracting the log2CPM for
the pre-treatment from each sample.  control is what is highlighted.
The pretreatment is the day 0 of CRISPR treatment, before CRISPR pgRNAs have taken effect.
`log2FC = log2CPM for each sample - pretreament log2CPM`
3. `Normalize by negative and positive controls` - Calculate a negative control
median for each sample and a positive control median for each sample and divide
each log2FC by this value.
`log2FC adjusted = log2FC /
(median negative control for a sample - median positive control for a sample)`"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gimap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/quick-start.html">Quick Start</a>
    </li>
    <li>
      <a href="../articles/timepoint-example.html">gimap for Timepoint Experiment</a>
    </li>
    <li>
      <a href="../articles/treatment_example.html">gimap for Treatment Experiment</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/FredHutch/gimap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Normalize Log fold changes</h1>
    <small class="dont-index">Source: <a href="https://github.com/FredHutch/gimap/blob/HEAD/R/04-normalize.R" class="external-link"><code>R/04-normalize.R</code></a></small>
    <div class="hidden name"><code>gimap_normalize.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This calculates the log fold change for a gimap dataset based on
the annotation and metadata provided.
gimap takes in a counts matrix that represents the number of cells that have
each type of pgRNA this data needs some normalization before CRISPR scores and
Genetic Interaction scores can be calculated.</p>
<p>There are four steps of normalization.
1. `Calculate log2CPM` - First we account for different read depths across samples
and transforms data to log2 counts per million reads.
`log2((counts / total counts for sample)) * 1 million) + 1)`
2. `Calculate log2 fold change` - This is done by subtracting the log2CPM for
the pre-treatment from each sample.  control is what is highlighted.
The pretreatment is the day 0 of CRISPR treatment, before CRISPR pgRNAs have taken effect.
`log2FC = log2CPM for each sample - pretreament log2CPM`</p>
<p>3. `Normalize by negative and positive controls` - Calculate a negative control
median for each sample and a positive control median for each sample and divide
each log2FC by this value.
`log2FC adjusted = log2FC /
(median negative control for a sample - median positive control for a sample)`</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gimap_normalize</span><span class="op">(</span></span>
<span>  .data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">gimap_dataset</span>,</span>
<span>  normalize_by_unexpressed <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  timepoints <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  treatments <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  control_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_ids_wo_annot <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  rm_ids_wo_annot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  missing_ids_file <span class="op">=</span> <span class="st">"missing_ids_file.csv"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg--data">.data<a class="anchor" aria-label="anchor" href="#arg--data"></a></dt>
<dd><p>Data can be piped in with a tidyverse pipe from function to function.
But the data must still be a gimap_dataset</p></dd>


<dt id="arg-gimap-dataset">gimap_dataset<a class="anchor" aria-label="anchor" href="#arg-gimap-dataset"></a></dt>
<dd><p>A special dataset structure that is setup using the
`setup_data()` function.</p></dd>


<dt id="arg-normalize-by-unexpressed">normalize_by_unexpressed<a class="anchor" aria-label="anchor" href="#arg-normalize-by-unexpressed"></a></dt>
<dd><p>TRUE/FALSE crispr data should be normalized so
that the median of unexpressed controls is 0. For this to happen set this to
TRUE but you need to have added TPM data in the gimap_annotate step using
cell_line_annotation or custom_tpm.</p></dd>


<dt id="arg-timepoints">timepoints<a class="anchor" aria-label="anchor" href="#arg-timepoints"></a></dt>
<dd><p>Specifies the column name of the metadata set up in
`$metadata$sample_metadata`
that has a factor that represents the timepoints.
Timepoints will be made into three categories:
plasmid for the earliest time point, early for all middle timepoints and
late for the latest timepoints.
The late timepoints will be the focus for the calculations. The column used
for timepoints must be numeric or at least ordinal.</p></dd>


<dt id="arg-treatments">treatments<a class="anchor" aria-label="anchor" href="#arg-treatments"></a></dt>
<dd><p>Specifies the column name of the metadata set up in
`$metadata$sample_metadata`
that has a factor that represents column that specifies the treatment applied to each.
The replicates will be kept collapsed to an average.</p></dd>


<dt id="arg-control-name">control_name<a class="anchor" aria-label="anchor" href="#arg-control-name"></a></dt>
<dd><p>A name that specifies the data either in the treatments
column that should be used as the control. This could be the Day 0 of treatment
or an untreated sample.
 For timepoints testing it will be assumed that the mininmum timepoint is the control.</p></dd>


<dt id="arg-num-ids-wo-annot">num_ids_wo_annot<a class="anchor" aria-label="anchor" href="#arg-num-ids-wo-annot"></a></dt>
<dd><p>default is 20; the number of pgRNA IDs to display to
console if they don't have corresponding annotation data;
ff there are more IDs without annotation data than this number, the output
will be sent to a file rather than the console.</p></dd>


<dt id="arg-rm-ids-wo-annot">rm_ids_wo_annot<a class="anchor" aria-label="anchor" href="#arg-rm-ids-wo-annot"></a></dt>
<dd><p>default is TRUE; whether or not to filter out pgRNA IDs
from the input dataset that don't have corresponding annotation data available</p></dd>


<dt id="arg-missing-ids-file">missing_ids_file<a class="anchor" aria-label="anchor" href="#arg-missing-ids-file"></a></dt>
<dd><p>If there are missing IDs and a file is saved, where
do you want this file to be saved? Provide a file path.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Should existing normalized_log_fc data in the gimap_dataset be overwritten?</p></dd>

</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gimap_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_example_data.html">get_example_data</a></span><span class="op">(</span><span class="st">"gimap"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Highly recommended but not required</span></span></span>
<span class="r-in"><span><span class="fu"><a href="run_qc.html">run_qc</a></span><span class="op">(</span><span class="va">gimap_dataset</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gimap_dataset</span> <span class="op">&lt;-</span> <span class="va">gimap_dataset</span> <span class="op">%&gt;%</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="gimap_filter.html">gimap_filter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="gimap_annotate.html">gimap_annotate</a></span><span class="op">(</span>cell_line <span class="op">=</span> <span class="st">"HELA"</span><span class="op">)</span> <span class="op">%&gt;%</span></span></span>
<span class="r-in"><span>  <span class="fu">gimap_normalize</span><span class="op">(</span></span></span>
<span class="r-in"><span>    timepoints <span class="op">=</span> <span class="st">"day"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># To see results</span></span></span>
<span class="r-in"><span><span class="va">gimap_dataset</span><span class="op">$</span><span class="va">normalized_log_fc</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Candace Savonen, Howard Baek, Kate Isaac.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

